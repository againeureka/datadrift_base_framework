# ddoc v2.0.3 ë¦´ë¦¬ìŠ¤ ë…¸íŠ¸

## ë¦´ë¦¬ìŠ¤ ì¼ì
2024-12-04

## ğŸ¯ Experiment ëª…ë ¹ ê°œí¸ - Trainer ê¸°ë°˜ ì‹¤í—˜ ì‹œìŠ¤í…œ

ddoc v2.0.3ì€ ê¸°ì¡´ YOLO ì „ìš© `exp run` ëª…ë ¹ì„ ë²”ìš© Trainer ê¸°ë°˜ ì‹œìŠ¤í…œìœ¼ë¡œ ì™„ì „íˆ ê°œí¸í•œ ì£¼ìš” ì—…ë°ì´íŠ¸ì…ë‹ˆë‹¤. ì‚¬ìš©ìê°€ `code/trainers/` í´ë”ì— í•™ìŠµ/í‰ê°€ ì½”ë“œë¥¼ ì‘ì„±í•˜ë©´, ddocê°€ í•´ë‹¹ ì½”ë“œë¥¼ ì‹¤í–‰í•˜ëŠ” ì¸í„°í˜ì´ìŠ¤ë¥¼ ì œê³µí•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ë‹¤ì–‘í•œ í”„ë ˆì„ì›Œí¬ì™€ ëª¨ë¸ì„ ì§€ì›í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.

## âœ¨ New Features

### 1. Trainer ê¸°ë°˜ ì‹¤í—˜ ì‹œìŠ¤í…œ

#### ìƒˆë¡œìš´ ëª…ë ¹ì–´
- **`ddoc exp train [trainer_name] --dataset [dataset]`**: trainer ì½”ë“œ ê¸°ë°˜ í•™ìŠµ ì‹¤í–‰
- **`ddoc exp eval [trainer_name] --dataset [dataset] --model [model_path]`**: trainer ì½”ë“œ ê¸°ë°˜ í‰ê°€ ì‹¤í–‰
- **`ddoc exp best [dataset]`**: MLflow ê¸°ë°˜ ìµœê³  ì„±ëŠ¥ ì‹¤í—˜ ì¡°íšŒ

#### ì‚¬ìš© ì˜ˆì‹œ
```bash
# ê¸°ë³¸ í•™ìŠµ
ddoc exp train yolo --dataset yolo_reference

# ëª¨ë¸ ì§€ì • (ìë™ ë‹¤ìš´ë¡œë“œ)
ddoc exp train yolo --dataset yolo_reference --model yolov8n.pt

# í‰ê°€ ì‹¤í–‰
ddoc exp eval yolo --dataset yolo_reference --model experiments/exp_*/weights/best.pt

# ìµœê³  ì„±ëŠ¥ ì‹¤í—˜ ì°¾ê¸°
ddoc exp best yolo_reference --metric mAP50-95
```

### 2. Trainer ì¸í„°í˜ì´ìŠ¤ í‘œì¤€í™”

TrainerëŠ” í‘œì¤€í™”ëœ ì¸í„°í˜ì´ìŠ¤ë¥¼ ë”°ë¼ì•¼ í•©ë‹ˆë‹¤:

#### ë””ë ‰í† ë¦¬ êµ¬ì¡°
```
code/trainers/{trainer_name}/
â”œâ”€â”€ train.py      # í•„ìˆ˜: train(dataset_path, output_dir, **kwargs) í•¨ìˆ˜
â”œâ”€â”€ eval.py       # í•„ìˆ˜: evaluate(model_path, dataset_path, output_dir, **kwargs) í•¨ìˆ˜
â””â”€â”€ config.yaml   # ì„ íƒ: ê¸°ë³¸ í•™ìŠµ íŒŒë¼ë¯¸í„°
```

#### train() í•¨ìˆ˜ ì‹œê·¸ë‹ˆì²˜
```python
from pathlib import Path
from typing import Dict, Any

def train(
    dataset_path: Path,
    output_dir: Path,
    **kwargs
) -> Dict[str, Any]:
    """
    í•™ìŠµ í•¨ìˆ˜
    
    Returns:
        {
            "model_path": str,      # í•™ìŠµëœ ëª¨ë¸ ê²½ë¡œ
            "metrics": dict,        # ë©”íŠ¸ë¦­ ë”•ì…”ë„ˆë¦¬
            "artifacts": list       # ì•„í‹°íŒ©íŠ¸ ê²½ë¡œ ë¦¬ìŠ¤íŠ¸
        }
    """
    # í•™ìŠµ ë¡œì§ êµ¬í˜„
    pass
```

#### evaluate() í•¨ìˆ˜ ì‹œê·¸ë‹ˆì²˜
```python
from pathlib import Path
from typing import Dict, Any

def evaluate(
    model_path: Path,
    dataset_path: Path,
    output_dir: Path,
    **kwargs
) -> Dict[str, Any]:
    """
    í‰ê°€ í•¨ìˆ˜
    
    Returns:
        {
            "metrics": dict,        # í‰ê°€ ë©”íŠ¸ë¦­
            "artifacts": list       # í‰ê°€ ê²°ê³¼ ì•„í‹°íŒ©íŠ¸
        }
    """
    # í‰ê°€ ë¡œì§ êµ¬í˜„
    pass
```

### 3. ì›Œí¬ìŠ¤í˜ì´ìŠ¤ êµ¬ì¡° í™•ì¥

#### ìƒˆë¡œìš´ ë””ë ‰í† ë¦¬
- **`code/trainers/`**: ì‚¬ìš©ì trainer ì½”ë“œ ì €ì¥ ë””ë ‰í† ë¦¬
  - `ddoc init` ì‹¤í–‰ ì‹œ ìë™ ìƒì„±
  - `--trainer` ì˜µì…˜ìœ¼ë¡œ ì½”ë“œ ì¶”ê°€ ì‹œ ìë™ ì •ë¦¬
- **`models/`**: ì‚¬ì „ í•™ìŠµ ëª¨ë¸ ì €ì¥ ë””ë ‰í† ë¦¬
  - `ddoc exp train` ì‹¤í–‰ ì‹œ ìë™ ìƒì„±
  - Ultralyticsê°€ ìë™ ë‹¤ìš´ë¡œë“œí•˜ëŠ” ëª¨ë¸ ì €ì¥

#### ëª¨ë¸ ê²½ë¡œ í•´ì„ ê·œì¹™
1. **ëª¨ë¸ ì´ë¦„ë§Œ ì§€ì •** (`yolov8n.pt`): `models/`ì—ì„œ ì°¾ê±°ë‚˜ ìë™ ë‹¤ìš´ë¡œë“œ
2. **ìƒëŒ€ ê²½ë¡œ ì§€ì •** (`models/custom.pt`): ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ê¸°ì¤€ìœ¼ë¡œ í•´ì„
3. **ì ˆëŒ€ ê²½ë¡œ ì§€ì •**: ê·¸ëŒ€ë¡œ ì‚¬ìš©

## ğŸ“¦ New Modules

### Core Services
- **`ddoc/core/trainer_service.py`**: Trainer ì½”ë“œ ë¡œë“œ ë° ì‹¤í–‰ ì„œë¹„ìŠ¤
  - Trainer ì½”ë“œ ë™ì  ë¡œë“œ
  - config.yaml íŒŒë¼ë¯¸í„° ë³‘í•©
  - MLflow í†µí•©

### CLI Commands
- **`ddoc/cli/commands/experiment/run_train.py`**: `exp train` ëª…ë ¹ êµ¬í˜„
- **`ddoc/cli/commands/experiment/run_eval.py`**: `exp eval` ëª…ë ¹ êµ¬í˜„
- **`ddoc/cli/commands/experiment/best.py`**: `exp best` ëª…ë ¹ êµ¬í˜„

## ğŸ”„ Changed

### í•¨ìˆ˜ ë³€ê²½
- **`get_dataset_path()`**: `data/{dataset_name}` ê²½ë¡œ ìë™ íƒìƒ‰ ì¶”ê°€
  - ì´ì „: ì ˆëŒ€ ê²½ë¡œë§Œ ì§€ì›
  - ì´í›„: ìƒëŒ€ ê²½ë¡œ ìë™ íƒìƒ‰ ì§€ì›

### ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì´ˆê¸°í™”
- **`workspace.py`**: `code/trainers/`, `models/` ë””ë ‰í† ë¦¬ ìë™ ìƒì„±
  - `ddoc init` ì‹¤í–‰ ì‹œ ìë™ìœ¼ë¡œ ìƒì„±
  - ê¸°ì¡´ í”„ë¡œì íŠ¸ì—ë„ ìˆ˜ë™ ìƒì„± ê°€ëŠ¥

## âš ï¸ Deprecated

### ëª…ë ¹ì–´ Deprecation
- **`ddoc exp run`**: `ddoc exp train`ìœ¼ë¡œ ëŒ€ì²´
  - ê¸°ì¡´ ëª…ë ¹ì€ ìœ ì§€ë˜ë‚˜ deprecated ìƒíƒœ
  - v2.1ì—ì„œ ì œê±° ì˜ˆì •

### MLflow UI ì‚¬ìš© ê¶Œì¥
ë‹¤ìŒ ëª…ë ¹ì–´ë“¤ì€ MLflow UI ì‚¬ìš©ì„ ê¶Œì¥í•©ë‹ˆë‹¤:
- `ddoc exp list` â†’ MLflow UI ì‚¬ìš©
- `ddoc exp show` â†’ MLflow UI ì‚¬ìš©
- `ddoc exp compare` â†’ MLflow UI ì‚¬ìš©
- `ddoc exp status` â†’ MLflow UI ì‚¬ìš©

## ğŸ“ Trainer ì‘ì„± ê°€ì´ë“œë¼ì¸

### ê¸°ë³¸ êµ¬ì¡°

**train.py ì˜ˆì‹œ:**
```python
from pathlib import Path
from typing import Dict, Any
from ultralytics import YOLO

def train(
    dataset_path: Path,
    output_dir: Path,
    model: str = "yolov8n.pt",
    epochs: int = 100,
    **kwargs
) -> Dict[str, Any]:
    # YOLO í•™ìŠµ
    yolo_model = YOLO(model)
    results = yolo_model.train(
        data=str(dataset_path / "data.yaml"),
        epochs=epochs,
        project=str(output_dir.parent),
        name=output_dir.name,
        **kwargs
    )
    
    return {
        "model_path": str(output_dir / "weights" / "best.pt"),
        "metrics": {
            "mAP50": results.results_dict.get("metrics/mAP50(B)", 0),
            "mAP50-95": results.results_dict.get("metrics/mAP50-95(B)", 0),
        },
        "artifacts": [str(output_dir / "results.png")]
    }
```

**eval.py ì˜ˆì‹œ:**
```python
from pathlib import Path
from typing import Dict, Any
from ultralytics import YOLO

def evaluate(
    model_path: Path,
    dataset_path: Path,
    output_dir: Path,
    **kwargs
) -> Dict[str, Any]:
    # ëª¨ë¸ ë¡œë“œ ë° í‰ê°€
    model = YOLO(str(model_path))
    results = model.val(data=str(dataset_path / "data.yaml"), **kwargs)
    
    return {
        "metrics": {
            "mAP50": results.results_dict.get("metrics/mAP50(B)", 0),
            "mAP50-95": results.results_dict.get("metrics/mAP50-95(B)", 0),
        },
        "artifacts": [str(output_dir / "confusion_matrix.png")]
    }
```

### data.yaml ê¶Œì¥ í˜•ì‹ (YOLO)

```yaml
names:
  - object
nc: 1
path: data/dataset_name    # ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ë£¨íŠ¸ ê¸°ì¤€ ìƒëŒ€ ê²½ë¡œ
train: train/images
val: valid/images
test: test/images
```

**ì¤‘ìš”**: `path` í•„ë“œëŠ” ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ë£¨íŠ¸ ê¸°ì¤€ ìƒëŒ€ ê²½ë¡œë¥¼ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤. ì´ë ‡ê²Œ í•˜ë©´ ì„œë²„ í™˜ê²½ì´ë‚˜ Docker ì»¨í…Œì´ë„ˆì—ì„œë„ ë™ì¼í•˜ê²Œ ì‘ë™í•©ë‹ˆë‹¤.

### config.yaml ì˜ˆì‹œ

```yaml
# code/trainers/yolo/config.yaml
model: "yolov8n.pt"
epochs: 100
batch: 16
imgsz: 640
device: "cpu"
```

ì´ ì„¤ì •ì€ `train()` í•¨ìˆ˜ì˜ `**kwargs`ë¡œ ì „ë‹¬ë©ë‹ˆë‹¤.

## ğŸ”§ Technical Details

### Trainer ë¡œë“œ ë©”ì»¤ë‹ˆì¦˜

1. `code/trainers/{trainer_name}/train.py`ì—ì„œ `train()` í•¨ìˆ˜ ë¡œë“œ
2. `code/trainers/{trainer_name}/eval.py`ì—ì„œ `evaluate()` í•¨ìˆ˜ ë¡œë“œ
3. `code/trainers/{trainer_name}/config.yaml`ì—ì„œ ê¸°ë³¸ íŒŒë¼ë¯¸í„° ë¡œë“œ
4. CLIì—ì„œ ì „ë‹¬ëœ íŒŒë¼ë¯¸í„°ì™€ ë³‘í•©
5. MLflow ì‹¤í—˜ ì‹œì‘
6. Trainer í•¨ìˆ˜ ì‹¤í–‰
7. ê²°ê³¼ë¥¼ `experiments/` ë””ë ‰í† ë¦¬ì— ì €ì¥ ë° MLflowì— ë¡œê¹…

### MLflow í†µí•©

ëª¨ë“  ì‹¤í—˜ì€ ìë™ìœ¼ë¡œ MLflowì— ë¡œê¹…ë©ë‹ˆë‹¤:
- íŒŒë¼ë¯¸í„°: epochs, batch, model ë“±
- ë©”íŠ¸ë¦­: mAP50, mAP50-95, precision, recall ë“±
- ì•„í‹°íŒ©íŠ¸: ëª¨ë¸ ê°€ì¤‘ì¹˜, í•™ìŠµ ê³¡ì„ , í˜¼ë™ í–‰ë ¬ ë“±

## ğŸ“š Updated Documentation

- [Trainer ì‹œìŠ¤í…œ ê°€ì´ë“œ](../guides/trainer.md) - Trainer ì‘ì„± ë° ì‚¬ìš©ë²•
- [ì‹¤í—˜ ê´€ë¦¬ ê°€ì´ë“œ](../guides/experiments.md) - ì‹¤í—˜ ì‹¤í–‰ ë° ì¶”ì 
- [ëª…ë ¹ì–´ ë ˆí¼ëŸ°ìŠ¤](../reference/commands.md) - ëª¨ë“  ëª…ë ¹ì–´ ìƒì„¸ ì„¤ëª…

## ğŸ“ ë§ˆì´ê·¸ë ˆì´ì…˜ ë…¸íŠ¸

### í˜¸í™˜ì„± ìœ ì§€
- âœ… ëª¨ë“  v2.0.2 ëª…ë ¹ì´ ë™ì¼í•˜ê²Œ ì‘ë™
- âœ… ê¸°ì¡´ ì‹¤í—˜ ê²°ê³¼ í˜¸í™˜ ìœ ì§€
- âœ… ì„¤ì • ë³€ê²½ ë¶ˆí•„ìš”

### ê¸°ì¡´ ì‚¬ìš©ìë¥¼ ìœ„í•´
- `ddoc exp run` ëª…ë ¹ì€ ì—¬ì „íˆ ì‘ë™í•˜ì§€ë§Œ `ddoc exp train` ì‚¬ìš© ê¶Œì¥
- MLflow UIë¥¼ ì‚¬ìš©í•˜ì—¬ ì‹¤í—˜ ê²°ê³¼ í™•ì¸ ê¶Œì¥
- Trainer ì‹œìŠ¤í…œìœ¼ë¡œ ì „í™˜ ì‹œ [Trainer ê°€ì´ë“œ](../guides/trainer.md) ì°¸ì¡°

## ğŸ™ ê°ì‚¬ì˜ ë§

ì´ë²ˆ ë¦´ë¦¬ìŠ¤ëŠ” ì‹¤í—˜ ì‹œìŠ¤í…œì˜ ìœ ì—°ì„±ê³¼ í™•ì¥ì„±ì— ì¤‘ì ì„ ë‘ì–´, ddocì„ ë‹¤ì–‘í•œ í”„ë ˆì„ì›Œí¬ì™€ ëª¨ë¸ì„ ì§€ì›í•˜ëŠ” ë²”ìš© ì‹¤í—˜ ë„êµ¬ë¡œ ë§Œë“­ë‹ˆë‹¤.

---

**ì „ì²´ ë³€ê²½ ì´ë ¥**: v2.0.2ì™€ v2.0.3 ì‚¬ì´ì˜ git log ì°¸ì¡°

